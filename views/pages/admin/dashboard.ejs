<%- include('../../partials/admin-header', {title: 'Admin Dashboard - SkinSense', description: 'Comprehensive admin dashboard for managing SkinSense operations.'}) %>

<%- include('../../partials/admin-nav', {currentPage: 'dashboard'}) %>

<!-- Admin Dashboard -->
<div class="admin-dashboard with-nav">
    <!-- Dashboard Header -->
    <div class="dashboard-header">
        <div class="header-content">
            <div class="header-left">
                <h1><i class="fas fa-tachometer-alt me-3"></i>Admin Dashboard</h1>
                <p>Welcome back, <%= user.firstName || user.email %>! Here's what's happening at SkinSense.</p>
            </div>
            <div class="header-right">
                <div class="admin-actions">
                    <a href="/admin/services/new" class="btn btn-success">
                        <i class="fas fa-plus me-2"></i>Add Service
                    </a>
                    <a href="/admin/bookings" class="btn btn-primary">
                        <i class="fas fa-calendar me-2"></i>View Bookings
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Stats Overview -->
    <div class="stats-overview">
        <div class="row g-4">
            <div class="col-lg-3 col-md-6">
                <div class="stat-card stat-primary">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number" id="totalUsers">0</div>
                        <div class="stat-label">Total Users</div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i> +12% this month
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-3 col-md-6">
                <div class="stat-card stat-success">
                    <div class="stat-icon">
                        <i class="fas fa-spa"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number" id="totalServices">0</div>
                        <div class="stat-label">Active Services</div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i> +3 new this week
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-3 col-md-6">
                <div class="stat-card stat-warning">
                    <div class="stat-icon">
                        <i class="fas fa-calendar-check"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number" id="totalBookings">0</div>
                        <div class="stat-label">Total Bookings</div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i> +25% this month
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-3 col-md-6">
                <div class="stat-card stat-info">
                    <div class="stat-icon">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number" id="totalRevenue">$0</div>
                        <div class="stat-label">Total Revenue</div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i> +18% this month
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Dashboard Content -->
    <div class="dashboard-content">
        <div class="row g-4">
            <!-- Recent Bookings -->
            <div class="col-lg-8">
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3><i class="fas fa-calendar-alt me-2"></i>Recent Bookings</h3>
                        <a href="/admin/bookings" class="btn btn-outline-primary btn-sm">View All</a>
                    </div>
                    <div class="card-body">
                        <div class="bookings-table-container">
                            <table class="table bookings-table">
                                <thead>
                                    <tr>
                                        <th>Client</th>
                                        <th>Service</th>
                                        <th>Date & Time</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="recentBookingsTable">
                                    <!-- Bookings will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="col-lg-4">
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3><i class="fas fa-bolt me-2"></i>Quick Actions</h3>
                    </div>
                    <div class="card-body">
                        <div class="quick-actions-grid">
                            <a href="/admin/services/new" class="quick-action">
                                <div class="action-icon">
                                    <i class="fas fa-plus"></i>
                                </div>
                                <div class="action-content">
                                    <h5>Add Service</h5>
                                    <p>Create a new skincare service</p>
                                </div>
                            </a>
                            
                            <a href="/admin/bookings/new" class="quick-action">
                                <div class="action-icon">
                                    <i class="fas fa-calendar-plus"></i>
                                </div>
                                <div class="action-content">
                                    <h5>New Booking</h5>
                                    <p>Schedule an appointment</p>
                                </div>
                            </a>
                            
                            <a href="/admin/users" class="quick-action">
                                <div class="action-icon">
                                    <i class="fas fa-user-plus"></i>
                                </div>
                                <div class="action-content">
                                    <h5>Manage Users</h5>
                                    <p>View and manage clients</p>
                                </div>
                            </a>
                            
                            <a href="/admin/settings" class="quick-action">
                                <div class="action-icon">
                                    <i class="fas fa-cog"></i>
                                </div>
                                <div class="action-content">
                                    <h5>Settings</h5>
                                    <p>Configure system settings</p>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Additional Dashboard Sections -->
        <div class="row g-4 mt-4">
            <!-- Popular Services -->
            <div class="col-lg-6">
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3><i class="fas fa-star me-2"></i>Popular Services</h3>
                        <a href="/admin/services" class="btn btn-outline-primary btn-sm">Manage</a>
                    </div>
                    <div class="card-body">
                        <div class="popular-services-list" id="popularServicesList">
                            <!-- Popular services will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- System Status -->
            <div class="col-lg-6">
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3><i class="fas fa-server me-2"></i>System Status</h3>
                    </div>
                    <div class="card-body">
                        <div class="system-status">
                            <div class="status-item">
                                <div class="status-indicator status-online"></div>
                                <div class="status-content">
                                    <h6>Database</h6>
                                    <p>Connected to MongoDB Atlas</p>
                                </div>
                            </div>
                            <div class="status-item">
                                <div class="status-indicator status-online"></div>
                                <div class="status-content">
                                    <h6>Email Service</h6>
                                    <p>Nodemailer configured</p>
                                </div>
                            </div>
                            <div class="status-item">
                                <div class="status-indicator status-online"></div>
                                <div class="status-content">
                                    <h6>SMS Service</h6>
                                    <p>Twilio configured</p>
                                </div>
                            </div>
                            <div class="status-item">
                                <div class="status-indicator status-online"></div>
                                <div class="status-content">
                                    <h6>File Upload</h6>
                                    <p>Cloudinary configured</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.admin-dashboard {
    min-height: 100vh;
    background: #f8fafc;
    padding: 2rem;
}

.admin-dashboard.with-nav {
    margin-left: 250px;
    padding: 2rem;
    margin-top: 0;
}

.dashboard-header {
    background: white;
    border-radius: 15px;
    padding: 2rem;
    margin-bottom: 2rem;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    border: 1px solid rgba(0, 0, 0, 0.05);
}

.header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.header-left h1 {
    color: #2d3748;
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
}

.header-left p {
    color: #718096;
    font-size: 1.1rem;
    margin: 0;
}

.admin-actions {
    display: flex;
    gap: 1rem;
}

.stats-overview {
    margin-bottom: 2rem;
}

.stat-card {
    background: white;
    border-radius: 15px;
    padding: 2rem;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    border: 1px solid rgba(0, 0, 0, 0.05);
    display: flex;
    align-items: center;
    gap: 1.5rem;
    transition: all 0.3s ease;
}

.stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
}

.stat-icon {
    width: 60px;
    height: 60px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: white;
}

.stat-primary .stat-icon {
    background: linear-gradient(135deg, #667eea, #764ba2);
}

.stat-success .stat-icon {
    background: linear-gradient(135deg, #48bb78, #38a169);
}

.stat-warning .stat-icon {
    background: linear-gradient(135deg, #ed8936, #dd6b20);
}

.stat-info .stat-icon {
    background: linear-gradient(135deg, #4299e1, #3182ce);
}

.stat-content {
    flex: 1;
}

.stat-number {
    font-size: 2.5rem;
    font-weight: 700;
    color: #2d3748;
    margin-bottom: 0.25rem;
}

.stat-label {
    color: #718096;
    font-size: 0.9rem;
    font-weight: 500;
    margin-bottom: 0.5rem;
}

.stat-change {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    font-size: 0.8rem;
    font-weight: 500;
}

.stat-change.positive {
    color: #38a169;
}

.dashboard-card {
    background: white;
    border-radius: 15px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    border: 1px solid rgba(0, 0, 0, 0.05);
    overflow: hidden;
}

.card-header {
    padding: 1.5rem 2rem;
    border-bottom: 1px solid #e2e8f0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #f7fafc;
}

.card-header h3 {
    color: #2d3748;
    font-size: 1.3rem;
    font-weight: 600;
    margin: 0;
    display: flex;
    align-items: center;
}

.card-body {
    padding: 2rem;
}

.bookings-table-container {
    overflow-x: auto;
}

.bookings-table {
    width: 100%;
    border-collapse: collapse;
}

.bookings-table th {
    background: #f7fafc;
    color: #4a5568;
    font-weight: 600;
    padding: 1rem;
    text-align: left;
    border-bottom: 2px solid #e2e8f0;
    font-size: 0.9rem;
}

.bookings-table td {
    padding: 1rem;
    border-bottom: 1px solid #e2e8f0;
    vertical-align: middle;
}

.booking-status {
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 500;
    text-transform: uppercase;
}

.status-pending {
    background: #fef5e7;
    color: #d69e2e;
}

.status-confirmed {
    background: #f0fff4;
    color: #38a169;
}

.status-cancelled {
    background: #fed7d7;
    color: #e53e3e;
}

.quick-actions-grid {
    display: grid;
    gap: 1rem;
}

.quick-action {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: #f7fafc;
    border-radius: 10px;
    text-decoration: none;
    color: inherit;
    transition: all 0.3s ease;
    border: 1px solid #e2e8f0;
}

.quick-action:hover {
    background: #edf2f7;
    transform: translateX(5px);
    color: inherit;
    text-decoration: none;
}

.action-icon {
    width: 40px;
    height: 40px;
    background: linear-gradient(135deg, #667eea, #764ba2);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.2rem;
}

.action-content h5 {
    margin: 0 0 0.25rem 0;
    color: #2d3748;
    font-size: 1rem;
    font-weight: 600;
}

.action-content p {
    margin: 0;
    color: #718096;
    font-size: 0.85rem;
}

.popular-services-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.popular-service-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    background: #f7fafc;
    border-radius: 10px;
    border: 1px solid #e2e8f0;
}

.service-info h6 {
    margin: 0 0 0.25rem 0;
    color: #2d3748;
    font-weight: 600;
}

.service-info p {
    margin: 0;
    color: #718096;
    font-size: 0.85rem;
}

.service-stats {
    text-align: right;
}

.service-bookings {
    font-weight: 600;
    color: #667eea;
}

.service-revenue {
    font-size: 0.8rem;
    color: #718096;
}

.system-status {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.status-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: #f7fafc;
    border-radius: 10px;
    border: 1px solid #e2e8f0;
}

.status-indicator {
    width: 12px;
    height: 12px;
    border-radius: 50%;
}

.status-online {
    background: #48bb78;
    box-shadow: 0 0 0 3px rgba(72, 187, 120, 0.2);
}

.status-offline {
    background: #e53e3e;
    box-shadow: 0 0 0 3px rgba(229, 62, 62, 0.2);
}

.status-content h6 {
    margin: 0 0 0.25rem 0;
    color: #2d3748;
    font-weight: 600;
    font-size: 0.9rem;
}

.status-content p {
    margin: 0;
    color: #718096;
    font-size: 0.8rem;
}

/* Responsive Design */
@media (max-width: 1200px) {
    .header-content {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
    }
    
    .admin-actions {
        justify-content: center;
    }
}

@media (max-width: 768px) {
    .admin-dashboard {
        padding: 1rem;
    }
    
    .dashboard-header {
        padding: 1.5rem;
    }
    
    .header-left h1 {
        font-size: 2rem;
    }
    
    .stat-card {
        padding: 1.5rem;
    }
    
    .stat-number {
        font-size: 2rem;
    }
    
    .card-body {
        padding: 1.5rem;
    }
    
    .admin-actions {
        flex-direction: column;
        width: 100%;
    }
}
</style>

<script>
// Load dashboard data
document.addEventListener('DOMContentLoaded', function() {
    loadDashboardData();
});

async function loadDashboardData() {
    try {
        // Load stats
        await loadStats();
        
        // Load recent bookings
        await loadRecentBookings();
        
        // Load popular services
        await loadPopularServices();
        
    } catch (error) {
        console.error('Error loading dashboard data:', error);
        showNotification('Failed to load dashboard data', 'error');
    }
}

async function loadStats() {
    try {
        // Simulate API calls - replace with actual API endpoints
        const stats = {
            totalUsers: 156,
            totalServices: 12,
            totalBookings: 89,
            totalRevenue: 12450
        };
        
        document.getElementById('totalUsers').textContent = stats.totalUsers;
        document.getElementById('totalServices').textContent = stats.totalServices;
        document.getElementById('totalBookings').textContent = stats.totalBookings;
        document.getElementById('totalRevenue').textContent = `$${stats.totalRevenue.toLocaleString()}`;
        
    } catch (error) {
        console.error('Error loading stats:', error);
    }
}

async function loadRecentBookings() {
    try {
        // Simulate recent bookings data
        const bookings = [
            {
                id: 1,
                client: 'Sarah Johnson',
                service: 'Facial Treatment',
                date: '2024-01-15',
                time: '10:00 AM',
                status: 'confirmed'
            },
            {
                id: 2,
                client: 'Michael Chen',
                service: 'Acne Treatment',
                date: '2024-01-15',
                time: '2:00 PM',
                status: 'pending'
            },
            {
                id: 3,
                client: 'Emily Rodriguez',
                service: 'Anti-Aging Treatment',
                date: '2024-01-16',
                time: '11:00 AM',
                status: 'confirmed'
            }
        ];
        
        const tbody = document.getElementById('recentBookingsTable');
        tbody.innerHTML = '';
        
        bookings.forEach(booking => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>
                    <div class="d-flex align-items-center">
                        <div class="avatar-placeholder me-2">
                            <i class="fas fa-user"></i>
                        </div>
                        <span>${booking.client}</span>
                    </div>
                </td>
                <td>${booking.service}</td>
                <td>
                    <div>
                        <div>${booking.date}</div>
                        <small class="text-muted">${booking.time}</small>
                    </div>
                </td>
                <td>
                    <span class="booking-status status-${booking.status}">
                        ${booking.status}
                    </span>
                </td>
                <td>
                    <div class="btn-group btn-group-sm">
                        <button class="btn btn-outline-primary" onclick="viewBooking(${booking.id})">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-outline-success" onclick="editBooking(${booking.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                    </div>
                </td>
            `;
            tbody.appendChild(row);
        });
        
    } catch (error) {
        console.error('Error loading recent bookings:', error);
    }
}

async function loadPopularServices() {
    try {
        // Simulate popular services data
        const services = [
            {
                name: 'Facial Treatment',
                bookings: 45,
                revenue: 2250
            },
            {
                name: 'Acne Treatment',
                bookings: 32,
                revenue: 1920
            },
            {
                name: 'Anti-Aging Treatment',
                bookings: 28,
                revenue: 2800
            }
        ];
        
        const container = document.getElementById('popularServicesList');
        container.innerHTML = '';
        
        services.forEach(service => {
            const item = document.createElement('div');
            item.className = 'popular-service-item';
            item.innerHTML = `
                <div class="service-info">
                    <h6>${service.name}</h6>
                    <p>Professional skincare treatment</p>
                </div>
                <div class="service-stats">
                    <div class="service-bookings">${service.bookings} bookings</div>
                    <div class="service-revenue">$${service.revenue} revenue</div>
                </div>
            `;
            container.appendChild(item);
        });
        
    } catch (error) {
        console.error('Error loading popular services:', error);
    }
}

function viewBooking(bookingId) {
    // Implement view booking functionality
    showNotification('View booking functionality coming soon', 'info');
}

function editBooking(bookingId) {
    // Implement edit booking functionality
    showNotification('Edit booking functionality coming soon', 'info');
}

// Notification function
function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    notification.innerHTML = `
        <div class="notification-content">
            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
            <span>${message}</span>
        </div>
    `;
    
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6'};
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 10px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        z-index: 9999;
        transform: translateX(100%);
        transition: transform 0.3s ease;
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.style.transform = 'translateX(0)';
    }, 100);
    
    setTimeout(() => {
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => {
            document.body.removeChild(notification);
        }, 300);
    }, 3000);
}
</script>

</body>
</html>
